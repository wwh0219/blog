import{d as n}from"./app.a140cb59.js";import{_ as s}from"./plugin-vue_export-helper.21dcd24c.js";const a={},p=n(`<h1 id="\u4ECEyarn\u8FC1\u79FB\u5230pnpm" tabindex="-1"><a class="header-anchor" href="#\u4ECEyarn\u8FC1\u79FB\u5230pnpm" aria-hidden="true">#</a> \u4ECEyarn\u8FC1\u79FB\u5230pnpm</h1><h2 id="\u5355\u4ED3\u5E93" tabindex="-1"><a class="header-anchor" href="#\u5355\u4ED3\u5E93" aria-hidden="true">#</a> \u5355\u4ED3\u5E93</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">import</span> 
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u4ECEyarn.lock\u5BFC\u51FApnpm-lock.yaml</p><h2 id="monorepo" tabindex="-1"><a class="header-anchor" href="#monorepo" aria-hidden="true">#</a> monorepo</h2><ol><li><p>\u9996\u5148\u8FDB\u5165\u5404\u4E2A\u5B50\u6A21\u5757\u6267\u884C<em>pnpm install</em>\uFF0C\u5404\u4E2A\u5B50\u6A21\u5757\u7684<em>pnpm-lock</em>\u6587\u4EF6</p></li><li><p>\u6267\u884C\u4EE5\u4E0Bnodejs\u811A\u672C\uFF0C\u6839\u636E\u9700\u6C42\u4FEE\u6539subLocks\u7684\u914D\u7F6E</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> parse<span class="token punctuation">,</span> stringify<span class="token punctuation">,</span>parseDocument <span class="token punctuation">}</span> <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;yaml&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> subLocks<span class="token operator">=</span><span class="token punctuation">[</span>
  <span class="token string">&#39;./packages1/p1/pnpm-lock.yaml&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;./packages1/p2/pnpm-lock.yaml&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token keyword">const</span> jsonList<span class="token operator">=</span>subLocks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">dir</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> file<span class="token operator">=</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token string">&#39;utf8&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> json<span class="token operator">=</span><span class="token function">parse</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">packageName</span><span class="token operator">:</span>dir<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&#39;./&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&#39;/pnpm-lock.yaml&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    json
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> rootJson<span class="token operator">=</span><span class="token function">parse</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">&#39;./pnpm-lock.yaml&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;utf8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
jsonList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>packageName<span class="token punctuation">,</span>json<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>specifiers<span class="token punctuation">,</span>dependencies<span class="token punctuation">,</span>packages<span class="token punctuation">}</span><span class="token operator">=</span>json
  rootJson<span class="token punctuation">.</span>importers<span class="token punctuation">[</span>packageName<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>
    specifiers<span class="token punctuation">,</span>
    dependencies
  <span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>rootJson<span class="token punctuation">.</span>packages<span class="token punctuation">,</span>packages<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> newYAML<span class="token operator">=</span><span class="token function">stringify</span><span class="token punctuation">(</span>rootJson<span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">&#39;./pnpm-lock.yaml&#39;</span><span class="token punctuation">,</span>newYAML<span class="token punctuation">,</span><span class="token string">&#39;utf8&#39;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newYAML<span class="token punctuation">,</span>rootJson<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li><li><p>\u518D\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4\uFF0C\u5C06\u76EE\u5F55\u7684pnpm-lock\u8FDB\u884C\u683C\u5F0F\u5316</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">pnpm</span> <span class="token function">install</span> --fix-lockfile
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><strong>\u601D\u8DEF</strong>\uFF1A\u8BFB\u53D6\u5404\u4E2A\u5B50\u6A21\u5757\u7684pnpm-lock\u6587\u4EF6\uFF0C\u5C06\u4F9D\u8D56\u58F0\u660E\u4EE5workspace\u7684\u683C\u5F0F\u5408\u5E76\u5230\u6839\u76EE\u5F55\u7684pnpm-lock\u6587\u4EF6\u4E2D</p></li><li><p>\u7136\u540E\u5C31\u53EF\u4EE5\u5220\u9664\u6240\u6709\u7684yarn.lock\uFF0C\u4EE5\u53CApackages\u4E0B\u7684pnpm-lock.yarml\u6587\u4EF6\uFF0C\u53EA\u4FDD\u7559\u6839\u76EE\u5F55\u7684pnpm-lock.yarml\u5373\u53EF</p></li></ol>`,6);function t(o,e){return p}var u=s(a,[["render",t]]);export{u as default};
